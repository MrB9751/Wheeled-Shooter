package frc.robot.subsystem;

import edu.wpi.first.wpilibj.I2C;
import edu.wpi.first.wpilibj.DigitalOutput;
import edu.wpi.first.wpilibj2.command.SubsystemBase;
import com.revrobotics.ColorSensorV3;
import edu.wpi.first.wpilibj.util.Color;

public class ColorSensorSubsystem extends SubsystemBase {

  private static ColorSensorSubsystem instance;

  private final ColorSensorV3 colorSensor;
  private final DigitalOutput led;

  private static final double TOLERANCE = 0.15;
  private final Color targetColor = Color.kRed;

  private ColorSensorSubsystem() {
    colorSensor = new ColorSensorV3(I2C.Port.kOnboard);
    led = new DigitalOutput(0); // DIO port for LED
  }

  public static ColorSensorSubsystem getInstance() {
    if (instance == null) {
      instance = new ColorSensorSubsystem();
    }
    return instance;
  }

  public boolean isTargetColorDetected() {
    Color detected = colorSensor.getColor();

    return Math.abs(detected.red - targetColor.red) < TOLERANCE &&
           Math.abs(detected.green - targetColor.green) < TOLERANCE &&
           Math.abs(detected.blue - targetColor.blue) < TOLERANCE;
  }

  @Override
  public void periodic() {
    led.set(isTargetColorDetected());
  }
}

